"use strict";!function(){function a(){var a=angular.injector(["ng"]).get("$http"),b=angular.injector(["zeppelinWebApp"]).get("baseUrlSrv");return a.defaults.withCredentials=!0,a.get(b.getRestApiBase()+"/security/ticket").then(function(a){c.run(["$rootScope",function(b){b.ticket=angular.fromJson(a.data).body}])},function(a){})}function b(){angular.bootstrap(document,["zeppelinWebApp"])}var c=angular.module("zeppelinWebApp",["ngCookies","ngAnimate","ngRoute","ngSanitize","angular-websocket","ui.ace","ui.bootstrap","as.sortable","ngTouch","ngDragDrop","angular.filter","monospaced.elastic","puElasticInput","xeditable","ngToast","focus-if","ngResource","ui.grid","ui.grid.expandable","ui.grid.selection","ui.grid.pinning","ui.grid.infiniteScroll","ui.grid.autoResize","ui.grid.grouping","ui.grid.resizeColumns","ui.grid.exporter","ngJsonExplorer"]).filter("breakFilter",function(){return function(a){return a?a.replace(/\n/g,"<br />"):void 0}}).config(["$httpProvider","$routeProvider","ngToastProvider",function(a,b,c){a.defaults.withCredentials=!0,b.when("/notebook/:noteId",{templateUrl:"app/notebook/notebook.html",controller:"NotebookCtrl"}).when("/notebook/:noteId/paragraph?=:paragraphId",{templateUrl:"app/notebook/notebook.html",controller:"NotebookCtrl"}).when("/notebook/:noteId/paragraph/:paragraphId?",{templateUrl:"app/notebook/notebook.html",controller:"NotebookCtrl"}).when("/interpreter",{templateUrl:"app/interpreter/interpreter.html",controller:"InterpreterCtrl"}).when("/configuration",{templateUrl:"app/configuration/configuration.html",controller:"ConfigurationCtrl"}).when("/search/:searchTerm",{templateUrl:"app/search/result-list.html",controller:"SearchResultCtrl"}).otherwise({redirectTo:"/notebook/"+menuData[0].notebooks[0]}),c.configure({dismissButton:!0,dismissOnClick:!1,timeout:6e3})}]).run(["$rootScope","$window","$interval","$q","$http",function(a,b,c,d,e){$("#pageLoader").show(),a.$on("$routeChangeStart",function(a,b,c){$("#pageLoader").show()}),a.$on("$routeChangeError",function(a,b,c,d){$("#pageLoader").hide()}),a.$on("$viewContentLoaded",function(){})}]);angular.element(document).ready(function(){a().then(b)})}(),angular.module("zeppelinWebApp").controller("MainCtrl",["$scope","$rootScope","$window",function(a,b,c){a.looknfeel="default";var d=function(){a.asIframe=c.location.href.indexOf("asIframe")>-1};d(),b.$on("setIframe",function(b,c){b.defaultPrevented||(a.asIframe=c,b.preventDefault())}),b.$on("setLookAndFeel",function(b,c){!b.defaultPrevented&&c&&""!==c&&c!==a.looknfeel&&(a.looknfeel=c,b.preventDefault())}),b.$on("$routeChangeStart",function(a,c,d){b.$broadcast("setLookAndFeel","default")}),BootstrapDialog.defaultOptions.onshown=function(){angular.element("#"+this.id).find(".btn:last").focus()}}]),angular.module("zeppelinWebApp").controller("HomeCtrl",["$scope","notebookListDataFactory","websocketMsgSrv","$rootScope","arrayOrderingSrv","$http","baseUrlSrv",function(a,b,c,d,e,f,g){var h=this;h.notes=b,h.websocketMsgSrv=c,h.arrayOrderingSrv=e,h.notebookHome=!1,void 0!==d.ticket?h.staticHome=!1:h.staticHome=!0,a.isReloading=!1;var i=function(){f.get(g.getRestApiBase()+"/version").success(function(b,c,d,e){a.zeppelinVersion=b.body}).error(function(a,b,c,d){})},j=function(){c.getHomeNotebook(),i()};j(),a.$on("setNoteContent",function(a,b){b?(h.note=b,d.$broadcast("setLookAndFeel","home"),h.viewOnly=!0,h.notebookHome=!0,h.staticHome=!1):(h.staticHome=!0,h.notebookHome=!1)}),a.$on("setNoteMenu",function(b,c){a.isReloadingNotes=!1}),a.reloadNotebookList=function(){c.reloadAllNotesFromRepo(),a.isReloadingNotes=!0}}]),angular.module("zeppelinWebApp").controller("NotebookCtrl",["$scope","$route","$routeParams","$location","$rootScope","$http","websocketMsgSrv","baseUrlSrv","$timeout","SaveAsService",function(a,b,c,d,e,f,g,h,i,j){a.note=null,a.showEditor=!1,a.editorToggled=!1,a.tableToggled=!1,a.viewOnly=!1,a.showSetting=!1,a.looknfeelOption=["default","simple","report"],a.cronOption=[{name:"None",value:void 0},{name:"1m",value:"0 0/1 * * * ?"},{name:"5m",value:"0 0/5 * * * ?"},{name:"1h",value:"0 0 0/1 * * ?"},{name:"3h",value:"0 0 0/3 * * ?"},{name:"6h",value:"0 0 0/6 * * ?"},{name:"12h",value:"0 0 0/12 * * ?"},{name:"1d",value:"0 0 0 * * ?"}],a.interpreterSettings=[],a.interpreterBindings=[],a.isNoteDirty=null,a.saveTimer=null;var k=!1;a.$on("setConnectedStatus",function(a,b){k&&b&&l(),k=!0}),a.getCronOptionNameFromValue=function(b){if(!b)return"";for(var c in a.cronOption)if(a.cronOption[c].value===b)return a.cronOption[c].name;return b};var l=function(){g.getNotebook(c.noteId);var a=b.current;a&&setTimeout(function(){var b=a.params,c=$("#"+b.paragraph+"_container");if(c.length>0){var d=c.offset().top-103;$("html, body").scrollTo({top:d,left:0})}},1e3)};l(),a.focusParagraphOnClick=function(b){if(a.note)for(var c=0;c<a.note.paragraphs.length;c++){var d=a.note.paragraphs[c].id;if(jQuery.contains(angular.element("#"+d+"_container")[0],b.target)){a.$broadcast("focusParagraph",d,0,!0);break}}},document.addEventListener("click",a.focusParagraphOnClick),a.keyboardShortcut=function(b){a.viewOnly||a.$broadcast("keyEvent",b)},document.addEventListener("keydown",a.keyboardShortcut),a.removeNote=function(a){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to delete this notebook?",callback:function(b){b&&(g.deleteNotebook(a),d.path("/#"))}})},a.exportNotebook=function(){var b=JSON.stringify(a.note);j.SaveAs(b,a.note.name,"json")},a.cloneNote=function(a){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to clone this notebook?",callback:function(b){b&&(g.cloneNotebook(a),d.path("/#"))}})},a.checkpointNotebook=function(a){BootstrapDialog.confirm({closable:!0,title:"",message:"Commit notebook to current repository?",callback:function(b){b&&g.checkpointNotebook(c.noteId,a)}}),document.getElementById("note.checkpoint.message").value=""},a.runNote=function(){_.forEach(a.note.paragraphs,function(a,b){angular.element("#"+a.id+"_paragraphColumn_main").scope().runParagraph(a.text)})},a.autoRunNote=function(){a.isOnAutoRun=!0,_.forEach(a.note.paragraphs,function(a,b){angular.element("#"+a.id+"_paragraphColumn_main").scope().autoRefresh()})},a.clearAutoRunNote=function(){a.isOnAutoRun=!1,_.forEach(a.note.paragraphs,function(a,b){angular.element("#"+a.id+"_paragraphColumn_main").scope().clearAutoRefresh()})},a.saveNote=function(){a.note&&a.note.paragraphs&&(_.forEach(a.note.paragraphs,function(a,b){angular.element("#"+a.id+"_paragraphColumn_main").scope().saveParagraph()}),a.isNoteDirty=null)},a.clearAllParagraphOutput=function(){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to clear all output?",callback:function(b){b&&_.forEach(a.note.paragraphs,function(a,b){angular.element("#"+a.id+"_paragraphColumn_main").scope().clearParagraphOutput()})}})},a.toggleAllEditor=function(){a.editorToggled?a.$broadcast("openEditor"):a.$broadcast("closeEditor"),a.editorToggled=!a.editorToggled},a.showAllEditor=function(){a.$broadcast("openEditor")},a.hideAllEditor=function(){a.$broadcast("closeEditor")},a.toggleAllTable=function(){a.tableToggled?a.$broadcast("openTable"):a.$broadcast("closeTable"),a.tableToggled=!a.tableToggled},a.showAllTable=function(){a.$broadcast("openTable")},a.hideAllTable=function(){a.$broadcast("closeTable")},a.isNoteRunning=function(){var b=!1;if(!a.note)return!1;for(var c=0;c<a.note.paragraphs.length;c++)if("PENDING"===a.note.paragraphs[c].status||"RUNNING"===a.note.paragraphs[c].status){b=!0;break}return b},a.killSaveTimer=function(){a.saveTimer&&(i.cancel(a.saveTimer),a.saveTimer=null)},a.startSaveTimer=function(){a.killSaveTimer(),a.isNoteDirty=!0,a.saveTimer=i(function(){a.saveNote()},1e4)},angular.element(window).on("beforeunload",function(b){a.killSaveTimer(),a.saveNote()}),a.$on("$destroy",function(){angular.element(window).off("beforeunload"),a.killSaveTimer(),a.saveNote(),document.removeEventListener("click",a.focusParagraphOnClick),document.removeEventListener("keydown",a.keyboardShortcut)}),a.setLookAndFeel=function(b){a.note.config.looknfeel=b,a.setConfig()},a.setCronScheduler=function(b){a.note.config.cron=b,a.setConfig()},a.setReleaseResource=function(b){a.note.config.releaseresource=b,a.setConfig()},a.setConfig=function(b){b&&(a.note.config=b),g.updateNotebook(a.note.id,a.note.name,a.note.config)},a.sendNewName=function(){a.note.name&&g.updateNotebook(a.note.id,a.note.name,a.note.config)},a.$on("setNoteContent",function(b,d){a.paragraphUrl=c.paragraphId,a.asIframe=c.asIframe,a.paragraphUrl&&(d=n(a.paragraphUrl,d),e.$broadcast("setIframe",a.asIframe)),null===a.note?a.note=d:o(d),m(),p(q)});var m=function(){a.note.config.looknfeel?a.viewOnly="report"===a.note.config.looknfeel:a.note.config.looknfeel="default",e.$broadcast("setLookAndFeel",a.note.config.looknfeel)},n=function(a,b){var c={};c.id=b.id,c.name=b.name,c.config=b.config,c.info=b.info,c.paragraphs=[];for(var d=0;d<b.paragraphs.length;d++)if(b.paragraphs[d].id===a){c.paragraphs[0]=b.paragraphs[d],c.paragraphs[0].config||(c.paragraphs[0].config={}),c.paragraphs[0].config.editorHide=!0,c.paragraphs[0].config.tableHide=!1;break}return c};a.$on("insertParagraph",function(b,c,d){for(var e=-1,f=0;f<a.note.paragraphs.length;f++)if(a.note.paragraphs[f].id===c){e="above"===d?f:f+1;break}0>e||e>a.note.paragraphs.length||g.insertParagraph(e)}),a.$on("moveParagraphUp",function(b,c){for(var d=-1,e=0;e<a.note.paragraphs.length;e++)if(a.note.paragraphs[e].id===c){d=e-1;break}if(!(0>d||d>=a.note.paragraphs.length)){var f=a.note.paragraphs[d].id;angular.element("#"+c+"_paragraphColumn_main").scope().saveParagraph(),angular.element("#"+f+"_paragraphColumn_main").scope().saveParagraph(),g.moveParagraph(c,d)}}),a.$on("moveParagraphDown",function(b,c){for(var d=-1,e=0;e<a.note.paragraphs.length;e++)if(a.note.paragraphs[e].id===c){d=e+1;break}if(!(0>d||d>=a.note.paragraphs.length)){var f=a.note.paragraphs[d].id;angular.element("#"+c+"_paragraphColumn_main").scope().saveParagraph(),angular.element("#"+f+"_paragraphColumn_main").scope().saveParagraph(),g.moveParagraph(c,d)}}),a.$on("moveFocusToPreviousParagraph",function(b,c){for(var d=!1,e=a.note.paragraphs.length-1;e>=0;e--){if(d!==!1){a.$broadcast("focusParagraph",a.note.paragraphs[e].id,-1);break}a.note.paragraphs[e].id!==c||(d=!0)}}),a.$on("moveFocusToNextParagraph",function(b,c){for(var d=!1,e=0;e<a.note.paragraphs.length;e++){if(d!==!1){a.$broadcast("focusParagraph",a.note.paragraphs[e].id,0);break}a.note.paragraphs[e].id!==c||(d=!0)}});var o=function(b){b.name!==a.note.name&&(a.note.name=b.name),a.note.config=b.config,a.note.info=b.info;for(var c,d,e=b.paragraphs.map(function(a){return a.id}),f=a.note.paragraphs.map(function(a){return a.id}),g=e.length,h=f.length,i=0;i<a.note.paragraphs.length;i++){var j=a.note.paragraphs[i].id;if(angular.element("#"+j+"_paragraphColumn_main").scope().paragraphFocused){d=j;break}}if(g>h)for(var k in e){if(f[k]!==e[k]){a.note.paragraphs.splice(k,0,b.paragraphs[k]),c=b.paragraphs[k].id;break}a.$broadcast("updateParagraph",{note:a.note,paragraph:b.paragraphs[k]})}if(g===h)for(var l in e){var m=b.paragraphs[l];if(f[l]===e[l])a.$broadcast("updateParagraph",{note:a.note,paragraph:m});else{var n=f.indexOf(e[l]);a.note.paragraphs.splice(n,1),a.note.paragraphs.splice(l,0,m),f=a.note.paragraphs.map(function(a){return a.id})}d===e[l]&&(c=d)}if(h>g)for(var o in f)if(f[o]!==e[o]){a.note.paragraphs.splice(o,1);break}for(var p=0;p<a.note.paragraphs.length;p++)c===a.note.paragraphs[p].id&&(a.note.paragraphs[p].focus=!0)},p=function(b){f.get(h.getRestApiBase()+"/notebook/interpreter/bind/"+a.note.id).success(function(c,d,e,f){a.interpreterBindings=c.body,a.interpreterBindingsOrig=angular.copy(a.interpreterBindings),b&&b()}).error(function(a,b,c,d){})},q=function(){var b,c,d=!1;for(b in a.interpreterBindings)if(c=a.interpreterBindings[b],c.selected){d=!0;break}if(!d){var e={};for(b in a.interpreterBindings)c=a.interpreterBindings[b],e[c.group]||(c.selected=!0,e[c.group]=!0);a.showSetting=!0}};a.interpreterSelectionListeners={accept:function(a,b){return!0},itemMoved:function(a){},orderChanged:function(a){}},a.openSetting=function(){a.showSetting=!0,p()},a.closeSetting=function(){s()?BootstrapDialog.confirm({closable:!0,title:"",message:"Changes will be discarded.",callback:function(b){b&&a.$apply(function(){a.showSetting=!1})}}):a.showSetting=!1},a.saveSetting=function(){var b=[];for(var c in a.interpreterBindings){var d=a.interpreterBindings[c];d.selected&&b.push(d.id)}f.put(h.getRestApiBase()+"/notebook/interpreter/bind/"+a.note.id,b).success(function(b,c,d,e){a.showSetting=!1}).error(function(a,b,c,d){})},a.toggleSetting=function(){a.showSetting?a.closeSetting():a.openSetting()};var r=function(b){f.get(h.getRestApiBase()+"/notebook/"+a.note.id+"/permissions").success(function(c,d,e,f){a.permissions=c.body,a.permissionsOrig=angular.copy(a.permissions),b&&b()}).error(function(a,b,c,d){})};a.openPermissions=function(){a.showPermissions=!0,r()},a.closePermissions=function(){t()?BootstrapDialog.confirm({closable:!0,title:"",message:"Changes will be discarded.",callback:function(b){b&&a.$apply(function(){a.showPermissions=!1})}}):a.showPermissions=!1},a.savePermissions=function(){f.put(h.getRestApiBase()+"/notebook/"+a.note.id+"/permissions",a.permissions,{withCredentials:!0}).success(function(b,c,d,e){a.showPermissions=!1}).error(function(a,b,c,d){BootstrapDialog.alert({closable:!0,title:"Insufficient privileges",message:a.message})})},a.togglePermissions=function(){a.showPermissions?a.closePermissions():a.openPermissions()};var s=function(){return!angular.equals(a.interpreterBindings,a.interpreterBindingsOrig)},t=function(){return!angular.equals(a.permissions,a.permissionsOrig)}}]),angular.module("zeppelinWebApp").controller("InterpreterCtrl",["$scope","$route","$routeParams","$location","$rootScope","$http","baseUrlSrv","ngToast",function(a,b,c,d,e,f,g,h){var i=[];a.interpreterSettings=[],a.availableInterpreters={},a.showAddNewSetting=!1,a.showRepositoryInfo=!1,a._=_;var j=function(){f.get(g.getRestApiBase()+"/interpreter/setting").success(function(b,c,d,e){a.interpreterSettings=b.body}).error(function(a,b,c,d){})},k=function(){f.get(g.getRestApiBase()+"/interpreter").success(function(b,c,d,e){a.availableInterpreters=b.body}).error(function(a,b,c,d){})},l=function(a){angular.extend(a,{propertyValue:"",propertyKey:""})},m=function(a){angular.extend(a,{depArtifact:"",depExclude:""})},n=function(a){i.splice(a,1)};a.copyOriginInterpreterSettingProperties=function(b){var c=_.findIndex(a.interpreterSettings,{id:b});i[c]=angular.copy(a.interpreterSettings[c])},a.updateInterpreterSetting=function(b,c){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to update this interpreter and restart with new settings?",callback:function(d){if(d){var e=_.findIndex(a.interpreterSettings,{id:c}),i=a.interpreterSettings[e];(""!==i.propertyKey||i.propertyKey)&&a.addNewInterpreterProperty(c),(""!==i.depArtifact||i.depArtifact)&&a.addNewInterpreterDependency(c),i.option||(i.option={}),void 0===i.option.remote&&(i.option.remote=!0);var j={option:angular.copy(i.option),properties:angular.copy(i.properties),dependencies:angular.copy(i.dependencies)};f.put(g.getRestApiBase()+"/interpreter/setting/"+c,j).success(function(b,c,d,f){a.interpreterSettings[e]=b.body,n(e)}).error(function(a,c,d,e){h.danger({content:a.message,verticalPosition:"bottom"}),b.$show()})}}})},a.resetInterpreterSetting=function(b){var c=_.findIndex(a.interpreterSettings,{id:b});a.interpreterSettings[c]=angular.copy(i[c]),n(c)},a.removeInterpreterSetting=function(b){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to delete this interpreter setting?",callback:function(c){c&&f.delete(g.getRestApiBase()+"/interpreter/setting/"+b).success(function(c,d,e,f){var g=_.findIndex(a.interpreterSettings,{id:b});a.interpreterSettings.splice(g,1)}).error(function(a,b,c,d){})}})},a.newInterpreterGroupChange=function(){for(var b=_.pluck(_.filter(a.availableInterpreters,{group:a.newInterpreterSetting.group}),"properties"),c={},d=0;d<b.length;d++){var e=b[d];for(var f in e)c[f]={value:e[f].defaultValue,description:e[f].description}}a.newInterpreterSetting.properties=c},a.restartInterpreterSetting=function(b){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to restart this interpreter?",callback:function(c){c&&f.put(g.getRestApiBase()+"/interpreter/setting/restart/"+b).success(function(c,d,e,f){var g=_.findIndex(a.interpreterSettings,{id:b});a.interpreterSettings[g]=c.body}).error(function(a,b,c,d){})}})},a.addNewInterpreterSetting=function(){if(!a.newInterpreterSetting.name||!a.newInterpreterSetting.group)return void BootstrapDialog.alert({closable:!0,title:"Add interpreter",message:"Please determine name and interpreter"});if(_.findIndex(a.interpreterSettings,{name:a.newInterpreterSetting.name})>=0)return void BootstrapDialog.alert({closable:!0,title:"Add interpreter",message:"Name "+a.newInterpreterSetting.name+" already exists"});var b=a.newInterpreterSetting;(""!==b.propertyKey||b.propertyKey)&&a.addNewInterpreterProperty(),(""!==b.depArtifact||b.depArtifact)&&a.addNewInterpreterDependency();var c=angular.copy(a.newInterpreterSetting),d={};for(var e in b.properties)d[e]=b.properties[e].value;c.properties=d,f.post(g.getRestApiBase()+"/interpreter/setting",c).success(function(b,c,d,e){a.resetNewInterpreterSetting(),j(),a.showAddNewSetting=!1}).error(function(a,b,c,d){h.danger({content:a.message,verticalPosition:"bottom"})})},a.cancelInterpreterSetting=function(){a.showAddNewSetting=!1,a.resetNewInterpreterSetting()},a.resetNewInterpreterSetting=function(){a.newInterpreterSetting={name:void 0,group:void 0,properties:{},dependencies:[],option:{remote:!0,perNoteSession:!1}},l(a.newInterpreterSetting)},a.removeInterpreterProperty=function(b,c){if(void 0===c)delete a.newInterpreterSetting.properties[b];else{var d=_.findIndex(a.interpreterSettings,{id:c});delete a.interpreterSettings[d].properties[b]}},a.removeInterpreterDependency=function(b,c){if(void 0===c)a.newInterpreterSetting.dependencies=_.reject(a.newInterpreterSetting.dependencies,function(a){return a.groupArtifactVersion===b});else{var d=_.findIndex(a.interpreterSettings,{id:c});a.interpreterSettings[d].dependencies=_.reject(a.interpreterSettings[d].dependencies,function(a){return a.groupArtifactVersion===b})}},a.addNewInterpreterProperty=function(b){if(void 0===b){if(!a.newInterpreterSetting.propertyKey||""===a.newInterpreterSetting.propertyKey)return;a.newInterpreterSetting.properties[a.newInterpreterSetting.propertyKey]={value:a.newInterpreterSetting.propertyValue},l(a.newInterpreterSetting)}else{var c=_.findIndex(a.interpreterSettings,{id:b}),d=a.interpreterSettings[c];if(!d.propertyKey||""===d.propertyKey)return;d.properties[d.propertyKey]=d.propertyValue,l(d)}},a.addNewInterpreterDependency=function(b){if(void 0===b){if(!a.newInterpreterSetting.depArtifact||""===a.newInterpreterSetting.depArtifact)return;var c=a.newInterpreterSetting;for(var d in c.dependencies)c.dependencies[d].groupArtifactVersion===c.depArtifact&&(c.dependencies[d]={groupArtifactVersion:c.depArtifact,exclusions:c.depExclude},c.dependencies.splice(d,1));c.dependencies.push({groupArtifactVersion:c.depArtifact,exclusions:""===c.depExclude?[]:c.depExclude}),m(c)}else{var e=_.findIndex(a.interpreterSettings,{id:b}),f=a.interpreterSettings[e];if(!f.depArtifact||""===f.depArtifact)return;for(var g in f.dependencies)f.dependencies[g].groupArtifactVersion===f.depArtifact&&(f.dependencies[g]={groupArtifactVersion:f.depArtifact,exclusions:f.depExclude},f.dependencies.splice(g,1));f.dependencies.push({groupArtifactVersion:f.depArtifact,exclusions:""===f.depExclude?[]:f.depExclude}),m(f)}},a.resetNewRepositorySetting=function(){a.newRepoSetting={id:void 0,url:void 0,snapshot:!1,username:void 0,password:void 0}};var o=function(){f.get(g.getRestApiBase()+"/interpreter/repository").success(function(b,c,d,e){a.repositories=b.body}).error(function(a,b,c,d){})};a.addNewRepository=function(){var b=angular.copy(a.newRepoSetting);f.post(g.getRestApiBase()+"/interpreter/repository",b).success(function(b,c,d,e){o(),a.resetNewRepositorySetting(),angular.element("#repoModal").modal("hide")}).error(function(a,b,c,d){})},a.removeRepository=function(b){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to delete this repository?",callback:function(c){c&&f.delete(g.getRestApiBase()+"/interpreter/repository/"+b).success(function(c,d,e,f){var g=_.findIndex(a.repositories,{id:b});a.repositories.splice(g,1)}).error(function(a,b,c,d){})}})},a.isDefaultRepository=function(a){return"central"===a||"local"===a};var p=function(){a.resetNewInterpreterSetting(),a.resetNewRepositorySetting(),j(),k(),o()};p()}]),angular.module("zeppelinWebApp").controller("ConfigurationCtrl",["$scope","$route","$routeParams","$location","$rootScope","$http","baseUrlSrv",function(a,b,c,d,e,f,g){a.configrations=[],a._=_;var h=function(){f.get(g.getRestApiBase()+"/configurations/all").success(function(b,c,d,e){a.configurations=b.body}).error(function(a,b,c,d){})},i=function(){h()};i()}]),angular.module("zeppelinWebApp").controller("ParagraphCtrl",["$scope","$rootScope","$route","$window","$element","$routeParams","$location","$timeout","$compile","websocketMsgSrv","ngToast","$interval",function(b,c,d,e,f,g,h,i,j,k,l,m){function n(c){c.expandable&&c.expandable.on.rowExpandedStateChanged(a,o),b.gridApi=c}function o(a){a.isExpanded}var p="_Z_ANGULAR_FUNC_";b.parentNote=null,b.paragraph=null,b.originalText="",b.editor=null,b.data=[],b.gridOptions={onRegisterApi:n,infiniteScrollDown:!0,data:"data",treeRowHeaderAlwaysVisible:!1,enableHorizontalScrollbar:0,enableGridMenu:!1,exporterCsvFilename:"export.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),useExternalSorting:!1,expandableRowHeight:300,expandableRowTemplate:"app/notebook/paragraph/json-viewer.html"};var q=[],r=function(){return"RUNNING"===b.paragraph.status||"PENDING"===b.paragraph.status?void 0:void b.runParagraph(b.getEditorValue())};b.autoRefresh=function(){b.stopAutoRef=m(r,refreshInterval)},b.clearAutoRefresh=function(){angular.isDefined(b.stopAutoRef)&&(m.cancel(b.stopAutoRef),b.stopAutoRef=void 0),b.cancelParagraph()};var s=c.$new(!0,c);b.compiledScope=s,s.z={runParagraph:function(a){if(a){var c=b.parentNote.paragraphs.filter(function(b){return b.id===a});if(1===c.length){var d=c[0];k.runParagraph(d.id,d.title,d.text,d.config,d.settings.params)}else l.danger({content:"Cannot find a paragraph with id '"+a+"'",verticalPosition:"top",dismissOnTimeout:!1})}else l.danger({content:"Please provide a 'paragraphId' when calling z.runParagraph(paragraphId)",verticalPosition:"top",dismissOnTimeout:!1})},angularBind:function(a,b,c){c?k.clientBindAngularObject(g.noteId,a,b,c):l.danger({content:"Please provide a 'paragraphId' when calling z.angularBind(varName, value, 'PUT_HERE_PARAGRAPH_ID')",verticalPosition:"top",dismissOnTimeout:!1})},angularUnbind:function(a,b){b?k.clientUnbindAngularObject(g.noteId,a,b):l.danger({content:"Please provide a 'paragraphId' when calling z.angularUnbind(varName, 'PUT_HERE_PARAGRAPH_ID')",verticalPosition:"top",dismissOnTimeout:!1})}};var t={},u={"ace/mode/python":/^%(\w*\.)?pyspark\s*$/,"ace/mode/scala":/^%(\w*\.)?spark\s*$/,"ace/mode/sql":/^%(\w*\.)?\wql/,"ace/mode/markdown":/^%md/,"ace/mode/sh":/^%sh/};b.init=function(a,c){b.paragraph=a,b.parentNote=c,b.originalText=angular.copy(a.text),b.chart={},b.colWidthOption=[1,2,3,4,5,6,7,8,9,10,11,12],b.showTitleEditor=!1,b.paragraphFocused=!1,a.focus&&(b.paragraphFocused=!0),b.paragraph.config||(b.paragraph.config={}),v(),"TABLE"===b.getResultType()?(b.loadTableData(b.paragraph.result),b.setGraphMode(b.getGraphMode(),!1,!1)):"HTML"===b.getResultType()?b.renderHtml():"ANGULAR"===b.getResultType()?b.renderAngular():"TEXT"===b.getResultType()&&b.renderText()},b.renderHtml=function(){var a=function(){if(angular.element("#p"+b.paragraph.id+"_html").length)try{angular.element("#p"+b.paragraph.id+"_html").html(b.paragraph.result.msg),angular.element("#p"+b.paragraph.id+"_html").find("pre code").each(function(a,b){hljs.highlightBlock(b)})}catch(c){}else i(a,10)};i(a)},b.renderAngular=function(){var a=function(){if(angular.element("#p"+b.paragraph.id+"_angular").length)try{angular.element("#p"+b.paragraph.id+"_angular").html(b.paragraph.result.msg),j(angular.element("#p"+b.paragraph.id+"_angular").contents())(s)}catch(c){}else i(a,10)};i(a)},b.renderText=function(){var a=function(){try{var a=JSON.parse(b.paragraph.result.msg)}catch(c){}a&&a.rows&&a.rows.length>0&&(b.data=a.rows)};i(a)},b.clearTextOutput=function(){var a=angular.element("#p"+b.paragraph.id+"_text");a.length&&a.children().remove()},b.appendTextOutput=function(a){var c=angular.element("#p"+b.paragraph.id+"_text");if(c.length)for(var d=a.split("\n"),e=0;e<d.length;e++)c.append(angular.element("<div></div>").text(d[e]));if(b.keepScrollDown){var f=angular.element("#p"+b.paragraph.id+"_text");f[0].scrollTop=f[0].scrollHeight}},b.$on("angularObjectUpdate",function(a,c){var e=d.current.pathParams.noteId;if(!c.noteId||c.noteId===e&&(!c.paragraphId||c.paragraphId===b.paragraph.id)){var f=s,g=c.angularObject.name;if(angular.equals(c.angularObject.object,f[g]))return;if(t[g]?(t[g].noteId=t[g].noteId||c.noteId,t[g].paragraphId=t[g].paragraphId||c.paragraphId):t[g]={interpreterGroupId:c.interpreterGroupId,noteId:c.noteId,paragraphId:c.paragraphId},t[g].skipEmit=!0,t[g].clearWatcher||(t[g].clearWatcher=f.$watch(g,function(a,b){return t[g].skipEmit?void(t[g].skipEmit=!1):void k.updateAngularObject(t[g].noteId,t[g].paragraphId,g,a,t[g].interpreterGroupId)})),f[g]=c.angularObject.object,g.startsWith(p)){var h=g.substring(p.length);f[h]=function(){f[g]=arguments}}}}),b.$on("angularObjectRemove",function(a,c){var e=d.current.pathParams.noteId;if(!c.noteId||c.noteId===e&&(!c.paragraphId||c.paragraphId===b.paragraph.id)){var f=s,g=c.name;if(t[g]&&(t[g].clearWatcher(),t[g]=void 0),f[g]=void 0,g.startsWith(p)){var h=g.substring(p.length);f[h]=void 0}}});var v=function(){var a=b.paragraph.config;a.colWidth||(a.colWidth=12),a.graph||(a.graph={}),a.graph.mode||(a.graph.mode="table"),a.graph.height||(a.graph.height=300),a.graph.optionOpen||(a.graph.optionOpen=!1),a.graph.keys||(a.graph.keys=[]),a.graph.values||(a.graph.values=[]),a.graph.groups||(a.graph.groups=[]),a.graph.scatter||(a.graph.scatter={}),void 0===a.enabled&&(a.enabled=!0)};b.getIframeDimensions=function(){if(b.asIframe){var a="#"+g.paragraphId+"_container",c=angular.element(a).height();return c}return 0},b.$watch(b.getIframeDimensions,function(a,c){if(b.asIframe&&a){var d={};d.height=a,d.url=h.$$absUrl,e.parent.postMessage(angular.toJson(d),"*")}});var w=function(a){return!a};b.$on("updateParagraph",function(a,d){if(!(d.paragraph.id!==b.paragraph.id||d.paragraph.dateCreated===b.paragraph.dateCreated&&d.paragraph.dateFinished===b.paragraph.dateFinished&&d.paragraph.dateStarted===b.paragraph.dateStarted&&d.paragraph.dateUpdated===b.paragraph.dateUpdated&&d.paragraph.status===b.paragraph.status&&d.paragraph.jobName===b.paragraph.jobName&&d.paragraph.title===b.paragraph.title&&w(d.paragraph.result)===w(b.paragraph.result)&&d.paragraph.errorMessage===b.paragraph.errorMessage&&angular.equals(d.paragraph.settings,b.paragraph.settings)&&angular.equals(d.paragraph.config,b.paragraph.config))){var e=b.getResultType(),f=b.getResultType(d.paragraph),g=b.getGraphMode(),h=b.getGraphMode(d.paragraph),i=d.paragraph.dateFinished!==b.paragraph.dateFinished||w(d.paragraph.result)!==w(b.paragraph.result),j=d.paragraph.status!==b.paragraph.status;if(b.paragraph.text!==d.paragraph.text&&(b.dirtyText?b.dirtyText===d.paragraph.text?(b.paragraph.text=d.paragraph.text,b.dirtyText=void 0,b.originalText=angular.copy(d.paragraph.text)):b.paragraph.text=b.dirtyText:(b.paragraph.text=d.paragraph.text,b.originalText=angular.copy(d.paragraph.text))),b.paragraph.aborted=d.paragraph.aborted,b.paragraph.dateUpdated=d.paragraph.dateUpdated,b.paragraph.dateCreated=d.paragraph.dateCreated,b.paragraph.dateFinished=d.paragraph.dateFinished,b.paragraph.dateStarted=d.paragraph.dateStarted,b.paragraph.errorMessage=d.paragraph.errorMessage,b.paragraph.jobName=d.paragraph.jobName,b.paragraph.title=d.paragraph.title,b.paragraph.lineNumbers=d.paragraph.lineNumbers,b.paragraph.status=d.paragraph.status,b.paragraph.result=d.paragraph.result,b.paragraph.settings=d.paragraph.settings,b.asIframe?(d.paragraph.config.editorHide=!0,d.paragraph.config.tableHide=!1,b.paragraph.config=d.paragraph.config):(b.paragraph.config=d.paragraph.config,v()),"TABLE"===f?(b.loadTableData(b.paragraph.result),("TABLE"!==e||i)&&(G(),H()),g!==h?b.setGraphMode(h,!1,!1):b.setGraphMode(h,!1,!0)):"HTML"===f&&i?b.renderHtml():"ANGULAR"===f&&i?b.renderAngular():"TEXT"===f&&i&&b.renderText(),j||i){var k=angular.element('div[id$="_paragraphColumn_main"');k.length>=2&&k[k.length-2].id.startsWith(b.paragraph.id)&&setTimeout(function(){c.$broadcast("scrollToCursor")},500)}}}),b.$on("appendParagraphOutput",function(a,c){b.paragraph.id===c.paragraphId&&(b.flushStreamingOutput&&(b.clearTextOutput(),b.flushStreamingOutput=!1),b.appendTextOutput(c.data))}),b.$on("updateParagraphOutput",function(a,c){b.paragraph.id===c.paragraphId&&(b.clearTextOutput(),b.appendTextOutput(c.data))}),b.isRunning=function(){return"RUNNING"===b.paragraph.status||"PENDING"===b.paragraph.status},b.cancelParagraph=function(){k.cancelParagraphRun(b.paragraph.id)},b.runParagraph=function(a){k.runParagraph(b.paragraph.id,b.paragraph.title,a,b.paragraph.config,b.paragraph.settings.params),b.originalText=angular.copy(a),b.dirtyText=void 0},b.saveParagraph=function(){void 0!==b.dirtyText&&b.dirtyText!==b.originalText&&(z(b.paragraph.title,b.dirtyText,b.paragraph.config,b.paragraph.settings.params),b.originalText=angular.copy(b.dirtyText),b.dirtyText=void 0)},b.toggleEnableDisable=function(){b.paragraph.config.enabled=!b.paragraph.config.enabled;var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);z(b.paragraph.title,b.paragraph.text,c,a)},b.run=function(){var a=b.editor.getValue();a&&"RUNNING"!==b.paragraph.status&&"PENDING"!==b.paragraph.status&&b.runParagraph(a)},b.moveUp=function(){b.$emit("moveParagraphUp",b.paragraph.id)},b.moveDown=function(){b.$emit("moveParagraphDown",b.paragraph.id)},b.insertNew=function(a){b.$emit("insertParagraph",b.paragraph.id,a||"below")},b.removeParagraph=function(){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to delete this paragraph?",callback:function(a){a&&k.removeParagraph(b.paragraph.id)}})},b.clearParagraphOutput=function(){k.clearParagraphOutput(b.paragraph.id)},b.toggleEditor=function(){b.paragraph.config.editorHide?b.openEditor():b.closeEditor()},b.closeEditor=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);c.editorHide=!0,z(b.paragraph.title,b.paragraph.text,c,a)},b.openEditor=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);c.editorHide=!1,z(b.paragraph.title,b.paragraph.text,c,a)},b.closeTable=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);c.tableHide=!0,z(b.paragraph.title,b.paragraph.text,c,a)},b.openTable=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);c.tableHide=!1,z(b.paragraph.title,b.paragraph.text,c,a)},b.showTitle=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);c.title=!0,z(b.paragraph.title,b.paragraph.text,c,a)},b.hideTitle=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);c.title=!1,z(b.paragraph.title,b.paragraph.text,c,a)},b.setTitle=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);z(b.paragraph.title,b.paragraph.text,c,a)},b.showLineNumbers=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);
c.lineNumbers=!0,b.editor.renderer.setShowGutter(!0),z(b.paragraph.title,b.paragraph.text,c,a)},b.hideLineNumbers=function(){var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);c.lineNumbers=!1,b.editor.renderer.setShowGutter(!1),z(b.paragraph.title,b.paragraph.text,c,a)},b.columnWidthClass=function(a){return b.asIframe?"col-md-12":"col-md-"+a},b.changeColWidth=function(){angular.element(".navbar-right.open").removeClass("open");var a=angular.copy(b.paragraph.settings.params),c=angular.copy(b.paragraph.config);z(b.paragraph.title,b.paragraph.text,c,a)},b.toggleGraphOption=function(){var a=angular.copy(b.paragraph.config);a.graph.optionOpen?a.graph.optionOpen=!1:a.graph.optionOpen=!0;var c=angular.copy(b.paragraph.settings.params);z(b.paragraph.title,b.paragraph.text,a,c)},b.toggleOutput=function(){var a=angular.copy(b.paragraph.config);a.tableHide=!a.tableHide;var c=angular.copy(b.paragraph.settings.params);z(b.paragraph.title,b.paragraph.text,a,c)},b.toggleLineWithFocus=function(){var a=b.getGraphMode();return"lineWithFocusChart"===a?(b.setGraphMode("lineChart",!0),!0):"lineChart"===a?(b.setGraphMode("lineWithFocusChart",!0),!0):!1},b.loadForm=function(a,c){var d=a.defaultValue;c[a.name]&&(d=c[a.name]),b.paragraph.settings.params[a.name]=d},b.toggleCheckbox=function(a,c){var d=b.paragraph.settings.params[a.name].indexOf(c.value);d>-1?b.paragraph.settings.params[a.name].splice(d,1):b.paragraph.settings.params[a.name].push(c.value)},b.aceChanged=function(){b.dirtyText=b.editor.getSession().getValue(),b.startSaveTimer(),i(function(){b.setParagraphMode(b.editor.getSession(),b.dirtyText,b.editor.getCursorPosition())})},b.aceLoaded=function(a){var d=ace.require("ace/ext/language_tools"),e=ace.require("ace/range").Range;if(a.$blockScrolling=1/0,b.editor=a,"{{paragraph.id}}_editor"!==a.container.id){b.editor.renderer.setShowGutter(b.paragraph.config.lineNumbers),b.editor.setShowFoldWidgets(!1),b.editor.setHighlightActiveLine(!1),b.editor.setHighlightGutterLine(!1),b.editor.getSession().setUseWrapMode(!0),b.editor.setTheme("ace/theme/chrome"),b.paragraphFocused&&b.editor.focus(),x(a.container.id),angular.element(window).resize(function(){x(a.container.id)}),-1!==navigator.appVersion.indexOf("Mac")?(b.editor.setKeyboardHandler("ace/keyboard/emacs"),c.isMac=!0):-1===navigator.appVersion.indexOf("Win")&&-1===navigator.appVersion.indexOf("X11")&&-1===navigator.appVersion.indexOf("Linux")||(c.isMac=!1),b.setParagraphMode=function(a,c,d){if("undefined"==typeof d||0===d.row&&d.column<30)if("undefined"==typeof d&&b.paragraph.config.editorMode)a.setMode(b.paragraph.config.editorMode);else{var e="ace/mode/scala",f=a.getMode().$id;if(!u[f]||!u[f].test(c)){for(var g in u)if(g!==f&&u[g].test(c))return b.paragraph.config.editorMode=g,a.setMode(g),!0;b.paragraph.config.editorMode=e,a.setMode(e)}}};var f={getCompletions:function(a,c,d,f,g){if(b.editor.isFocused()){d=c.getTextRange(new e(0,0,d.row,d.column)).length;var h=c.getValue();k.completion(b.paragraph.id,h,d),b.$on("completionList",function(a,b){if(b.completions){var c=[];for(var d in b.completions){var e=b.completions[d];c.push({name:e,value:e,score:300})}g(null,c)}})}}};d.setCompleters([f,d.keyWordCompleter,d.snippetCompleter,d.textCompleter]),b.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!1,enableLiveAutocompletion:!1}),b.handleFocus=function(a){b.paragraphFocused=a,i(function(){b.$digest()})},b.editor.on("focus",function(){b.handleFocus(!0)}),b.editor.on("blur",function(){b.handleFocus(!1)}),b.editor.getSession().on("change",function(b,c){x(a.container.id)}),b.setParagraphMode(b.editor.getSession(),b.editor.getSession().getValue()),b.editor.commands.bindKey("ctrl-alt-n.",null),b.editor.commands.bindKey("ctrl-.","startAutocomplete"),b.editor.commands.bindKey("ctrl-space",null),b.editor.keyBinding.origOnCommandKey=b.editor.keyBinding.onCommandKey,b.editor.keyBinding.onCommandKey=function(a,c,d){if(b.editor.completer&&b.editor.completer.activated);else{if(parseInt(angular.element("#"+b.paragraph.id+"_editor > textarea").css("top").replace("px",""))<0){var e=b.editor.getCursorPosition(),f=b.editor.renderer.$cursorLayer.getPixelPosition(e,!0);angular.element("#"+b.paragraph.id+"_editor > textarea").css("top",f.top)}var g,h;38===d||80===d&&a.ctrlKey&&!a.altKey?(g=b.editor.getSession().getLength(),h=b.editor.getCursorPosition().row,0===h?b.$emit("moveFocusToPreviousParagraph",b.paragraph.id):b.scrollToCursor(b.paragraph.id,-1)):(40===d||78===d&&a.ctrlKey&&!a.altKey)&&(g=b.editor.getSession().getLength(),h=b.editor.getCursorPosition().row,h===g-1?b.$emit("moveFocusToNextParagraph",b.paragraph.id):b.scrollToCursor(b.paragraph.id,1))}this.origOnCommandKey(a,c,d)}}};var x=function(a){var c=b.editor,d=c.getSession().getScreenLength()*c.renderer.lineHeight+c.renderer.scrollBar.getWidth();angular.element("#"+a).height(d.toString()+"px"),c.resize()};c.$on("scrollToCursor",function(a){var c=angular.element('div[id$="_paragraphColumn_main"');c[c.length-1].id.startsWith(b.paragraph.id)&&b.scrollToCursor(b.paragraph.id,0)}),b.scrollToCursor=function(a,c){if(b.editor.isFocused()){var d,e=b.editor.renderer.lineHeight,f=103,g=50,h=angular.element(document).height(),i=angular.element(window).height(),j=angular.element(document).scrollTop(),k=angular.element("#"+a+"_editor").offset(),l=b.editor.getCursorPosition(),m=b.editor.renderer.$cursorLayer.getPixelPosition(l,!0),n=k.top+m.top+e*c;j+f+g>n?(d=n-f-(i-f)/3,0>d&&(d=0)):n>j+g+i-f&&(d=n-f-2*(i-f)/3,d>h&&(d=h));var o=angular.element("body");o.stop(),o.finish(),o.scrollTo(d,{axis:"y",interrupt:!0,duration:100})}};b.getEditorValue=function(){return b.editor.getValue()},b.getProgress=function(){return b.currentProgress?b.currentProgress:0},b.getExecutionTime=function(){var a=b.paragraph,c=Date.parse(a.dateFinished)-Date.parse(a.dateStarted);if(isNaN(c)||0>c)return b.isResultOutdated()?"outdated":"";var d="Took "+c/1e3+" seconds";return b.isResultOutdated()&&(d+=" (outdated)"),d},b.isResultOutdated=function(){var a=b.paragraph;return void 0!==a.dateUpdated&&Date.parse(a.dateUpdated)>Date.parse(a.dateStarted)},b.$on("updateProgress",function(a,c){c.id===b.paragraph.id&&(b.currentProgress=c.progress)}),b.$on("keyEvent",function(a,c){if(b.paragraphFocused){var d=b.paragraph.id,e=c.keyCode,f=!1,g=b.paragraph.config.editorHide;if(g&&(38===e||80===e&&c.ctrlKey&&!c.altKey))b.$emit("moveFocusToPreviousParagraph",d);else if(g&&(40===e||78===e&&c.ctrlKey&&!c.altKey))b.$emit("moveFocusToNextParagraph",d);else if(c.shiftKey&&13===e)b.run();else if(c.ctrlKey&&c.altKey&&67===e)b.cancelParagraph();else if(c.ctrlKey&&c.altKey&&68===e)b.removeParagraph();else if(c.ctrlKey&&c.altKey&&75===e)b.moveUp();else if(c.ctrlKey&&c.altKey&&74===e)b.moveDown();else if(c.ctrlKey&&c.altKey&&65===e)b.insertNew("above");else if(c.ctrlKey&&c.altKey&&66===e)b.insertNew("below");else if(c.ctrlKey&&c.altKey&&79===e)b.toggleOutput();else if(c.ctrlKey&&c.altKey&&82===e)b.toggleEnableDisable();else if(c.ctrlKey&&c.altKey&&69===e)b.toggleEditor();else if(c.ctrlKey&&c.altKey&&77===e)b.paragraph.config.lineNumbers?b.hideLineNumbers():b.showLineNumbers();else if(c.ctrlKey&&c.shiftKey&&189===e)b.paragraph.config.colWidth=Math.max(1,b.paragraph.config.colWidth-1),b.changeColWidth();else if(c.ctrlKey&&c.shiftKey&&187===e)b.paragraph.config.colWidth=Math.min(12,b.paragraph.config.colWidth+1),b.changeColWidth();else if(c.ctrlKey&&c.altKey&&(e>=48&&57>=e||189===e||187===e)){var h=12;h=48===e?10:189===e?11:187===e?12:e-48,b.paragraph.config.colWidth=h,b.changeColWidth()}else c.ctrlKey&&c.altKey&&84===e?b.paragraph.config.title?b.hideTitle():b.showTitle():f=!0;f||c.preventDefault()}}),b.$on("focusParagraph",function(a,c,d,e){if(b.paragraph.id===c){if(!b.paragraph.config.editorHide&&!e){b.editor.focus();var f;d>=0?(f=d,b.editor.gotoLine(f,0)):(f=b.editor.session.getLength(),b.editor.gotoLine(f,0)),b.scrollToCursor(b.paragraph.id,0)}b.handleFocus(!0)}else b.editor.blur(),b.handleFocus(!1)}),b.$on("runParagraph",function(a){b.runParagraph(b.editor.getValue())}),b.$on("openEditor",function(a){b.openEditor()}),b.$on("closeEditor",function(a){b.closeEditor()}),b.$on("openTable",function(a){b.openTable()}),b.$on("closeTable",function(a){b.closeTable()}),b.getResultType=function(a){var c=a?a:b.paragraph;return c.result&&c.result.type?c.result.type:"TEXT"},b.getBase64ImageSrc=function(a){return"data:image/png;base64,"+a},b.getGraphMode=function(a){var c=a?a:b.paragraph;return c.config.graph&&c.config.graph.mode?c.config.graph.mode:"table"},b.loadTableData=function(a){if(a&&"TABLE"===a.type){var b=[],c=[],d=[],e=a.msg.split("\n");a.comment="";for(var f=!1,g=0;g<e.length;g++){var h=e[g];if(f)a.comment+=h;else if(""!==h){for(var i=h.split("	"),j=[],k=[],l=0;l<i.length;l++){var m=i[l];0===g?b.push({name:m,index:l,aggr:"sum"}):(j.push(m),k.push({key:b[g]?b[g].name:void 0,value:m}))}0!==g&&(c.push(j),d.push(k))}else c.length>0&&(f=!0)}a.msgTable=d,a.columnNames=b,a.rows=c}},b.setGraphMode=function(a,c,d){if(c)y(a);else{G();var e=b.paragraph.config.graph.height;angular.element("#p"+b.paragraph.id+"_graph").height(e),a&&"table"!==a?F(a,b.paragraph.result,d):A(b.paragraph.result,d)}};var y=function(a){var c=angular.copy(b.paragraph.config),d=angular.copy(b.paragraph.settings.params);c.graph.mode=a,z(b.paragraph.title,b.paragraph.text,c,d)},z=function(a,c,d,e){k.commitParagraph(b.paragraph.id,a,c,d,e)},A=function(c,d,e){var f=function(){b.data=[],q=[];for(var c=0;c<b.paragraph.result.rows.length;c++){for(var d=b.paragraph.result.rows[c],e={},f=0;f<b.paragraph.result.columnNames.length;f++){var h=b.paragraph.result.columnNames[f].name;h=h.replace("[0]",""),e[h]=d[f],0==c&&(q.push({name:h,field:h,width:"*",wordWrap:!0,cellTooltip:!0,enableHiding:!1}),b.defined=!0)}a.data.push(e)}b.gridOptions.columnDefs=colSettings&&colSettings[g.noteId]?colSettings[g.noteId]:q},h=function(){if(angular.element("#p"+b.paragraph.id+"_table").length)try{f()}catch(a){}else i(h,10)};i(h)},B=function(a){return d3.format(",")(d3.round(a,3))},C=function(a){var b=d3.format(".3s")(a);switch(b[b.length-1]){case"G":return b.slice(0,-1)+"B"}return b},D=function(a,b){return!b[a]||!isNaN(parseFloat(b[a]))&&isFinite(b[a])?a:b[a]},E=function(a){return a>=Math.pow(10,6)?C(a):B(a)},F=function(a,c,d){if(!b.chart[a]){var e=nv.models[a]();b.chart[a]=e}var f,g,h=[];if("scatterChart"===a){var j=L(c,d);f=j.xLabels,g=j.yLabels,h=j.d3g,b.chart[a].xAxis.tickFormat(function(a){return D(a,f)}),b.chart[a].yAxis.tickFormat(function(a){return D(a,g)}),b.chart[a].tooltipContent(function(a,c,d,e,f){var g="<h3>"+a+"</h3>";return b.paragraph.config.graph.scatter.size&&b.isValidSizeOption(b.paragraph.config.graph.scatter,b.paragraph.result.rows)&&(g+="<p>"+f.point.size+"</p>"),g}),b.chart[a].showDistX(!0).showDistY(!0)}else{var k=I(c);if("pieChart"===a){var l=J(k,!0).d3g;if(b.chart[a].x(function(a){return a.label}).y(function(a){return a.value}),l.length>0)for(var m=0;m<l[0].values.length;m++){var n=l[0].values[m];h.push({label:n.x,value:n.y})}}else if("multiBarChart"===a)h=J(k,!0,!1,a).d3g,b.chart[a].yAxis.axisLabelDistance(50),b.chart[a].yAxis.tickFormat(function(a){return E(a)});else if("lineChart"===a||"stackedAreaChart"===a||"lineWithFocusChart"===a){var o=J(k,!1,!0);f=o.xLabels,h=o.d3g,b.chart[a].xAxis.tickFormat(function(a){return D(a,f)}),b.chart[a].yAxis.tickFormat(function(a){return E(a)}),b.chart[a].yAxis.axisLabelDistance(50),b.chart[a].useInteractiveGuideline&&b.chart[a].useInteractiveGuideline(!0),b.paragraph.config.graph.forceY?b.chart[a].forceY([0]):b.chart[a].forceY([])}}var p=function(){var c=b.paragraph.config.graph.height,d=300,e=150;try{h[0].values.length>e&&(d=0)}catch(f){}d3.select("#p"+b.paragraph.id+"_"+a+" svg").attr("height",b.paragraph.config.graph.height).datum(h).transition().duration(d).call(b.chart[a]);d3.select("#p"+b.paragraph.id+"_"+a+" svg").style.height=c+"px",nv.utils.windowResize(b.chart[a].update)},q=function(){if(0!==angular.element("#p"+b.paragraph.id+"_"+a+" svg").length)try{p()}catch(c){}else i(q,10)};i(q)};b.isGraphMode=function(a){return"TABLE"===b.getResultType()&&b.getGraphMode()===a},b.onGraphOptionChange=function(){G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)},b.removeGraphOptionKeys=function(a){b.paragraph.config.graph.keys.splice(a,1),G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)},b.removeGraphOptionValues=function(a){b.paragraph.config.graph.values.splice(a,1),G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)},b.removeGraphOptionGroups=function(a){b.paragraph.config.graph.groups.splice(a,1),G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)},b.setGraphOptionValueAggr=function(a,c){b.paragraph.config.graph.values[a].aggr=c,G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)},b.removeScatterOptionXaxis=function(a){b.paragraph.config.graph.scatter.xAxis=null,G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)},b.removeScatterOptionYaxis=function(a){b.paragraph.config.graph.scatter.yAxis=null,G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)},b.removeScatterOptionGroup=function(a){b.paragraph.config.graph.scatter.group=null,G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)},b.removeScatterOptionSize=function(a){b.paragraph.config.graph.scatter.size=null,G(),b.setGraphMode(b.paragraph.config.graph.mode,!0,!1)};var G=function(){var a=function(a){for(var b=0;b<a.length;b++)for(var c=b+1;c<a.length;c++)angular.equals(a[b],a[c])&&a.splice(c,1)},c=function(a){for(var c=0;c<a.length;c++){for(var d=!1,e=0;e<b.paragraph.result.columnNames.length;e++){var f=a[c],g=b.paragraph.result.columnNames[e];if(f.index===g.index&&f.name===g.name){d=!0;break}}d||a.splice(c,1)}},d=function(a){for(var c in a)if(a[c]){for(var d=!1,e=0;e<b.paragraph.result.columnNames.length;e++){var f=a[c],g=b.paragraph.result.columnNames[e];if(f.index===g.index&&f.name===g.name){d=!0;break}}d||(a[c]=null)}};a(b.paragraph.config.graph.keys),c(b.paragraph.config.graph.keys),c(b.paragraph.config.graph.values),a(b.paragraph.config.graph.groups),c(b.paragraph.config.graph.groups),d(b.paragraph.config.graph.scatter)},H=function(){0===b.paragraph.config.graph.keys.length&&b.paragraph.result.columnNames.length>0&&b.paragraph.config.graph.keys.push(b.paragraph.result.columnNames[0]),0===b.paragraph.config.graph.values.length&&b.paragraph.result.columnNames.length>1&&b.paragraph.config.graph.values.push(b.paragraph.result.columnNames[1]),b.paragraph.config.graph.scatter.xAxis||b.paragraph.config.graph.scatter.yAxis||(b.paragraph.result.columnNames.length>1?(b.paragraph.config.graph.scatter.xAxis=b.paragraph.result.columnNames[0],b.paragraph.config.graph.scatter.yAxis=b.paragraph.result.columnNames[1]):1===b.paragraph.result.columnNames.length&&(b.paragraph.config.graph.scatter.xAxis=b.paragraph.result.columnNames[0]))},I=function(a){for(var c=b.paragraph.config.graph.keys,d=b.paragraph.config.graph.groups,e=b.paragraph.config.graph.values,f={sum:function(a,b){var c=void 0!==a?isNaN(a)?1:parseFloat(a):0,d=void 0!==b?isNaN(b)?1:parseFloat(b):0;return c+d},count:function(a,b){var c=void 0!==a?parseInt(a):0,d=void 0!==b?1:0;return c+d},min:function(a,b){var c=void 0!==a?isNaN(a)?1:parseFloat(a):0,d=void 0!==b?isNaN(b)?1:parseFloat(b):0;return Math.min(c,d)},max:function(a,b){var c=void 0!==a?isNaN(a)?1:parseFloat(a):0,d=void 0!==b?isNaN(b)?1:parseFloat(b):0;return Math.max(c,d)},avg:function(a,b,c){var d=void 0!==a?isNaN(a)?1:parseFloat(a):0,e=void 0!==b?isNaN(b)?1:parseFloat(b):0;return d+e}},g={sum:!1,count:!1,min:!1,max:!1,avg:!0},h={},i={},j=0;j<a.rows.length;j++){for(var k=a.rows[j],l=h,m=i,n=0;n<c.length;n++){var o=c[n];l[o.name]||(l[o.name]={order:n,index:o.index,type:"key",children:{}}),l=l[o.name].children;var p=k[o.index];m[p]||(m[p]={}),m=m[p]}for(var q=0;q<d.length;q++){var r=d[q],s=k[r.index];l[s]||(l[s]={order:q,index:r.index,type:"group",children:{}}),l=l[s].children,m[s]||(m[s]={}),m=m[s]}for(var t=0;t<e.length;t++){var u=e[t],v=u.name+"("+u.aggr+")";l[v]||(l[v]={type:"value",order:t,index:u.index}),m[v]?m[v]={value:f[u.aggr](m[v].value,k[u.index],m[v].count+1),count:g[u.aggr]?m[v].count+1:m[v].count}:m[v]={value:"count"!==u.aggr?k[u.index]:1,count:1}}}return{schema:h,rows:i}},J=function(a,c,d,e){var f=[],g=a.schema,h=a.rows,i=b.paragraph.config.graph.values,j=function(a,b){return a?a+"."+b:b},k=function(a,b){for(var c in a.children)b[c]={},k(a.children[c],b[c])},l=function(a,b,c,e,f,g,h,i){"key"===b.type?(g=j(g,a),h=j(h,c)):"group"===b.type?i=j(i,c):("value"===b.type&&a===c||o)&&(i=j(i,c),f(g,h,i,e));for(var m in b.children)if(d&&"group"===b.children[m].type&&void 0===e[m]){var n={};k(b.children[m],n),l(m,b.children[m],m,n,f,g,h,i)}else for(var p in e)"key"!==b.children[m].type&&m!==p||l(m,b.children[m],p,e[p],f,g,h,i)},m=b.paragraph.config.graph.keys,n=b.paragraph.config.graph.groups;i=b.paragraph.config.graph.values;var o=0===m.length&&0===n.length&&i.length>0,p=0===m.length,q="multiBarChart"===e,r=Object.keys(g)[0],s={},t=0,u={},v=0,w={};for(var x in h)l(r,g[r],x,h[x],function(a,b,d,e){void 0===s[b]&&(w[t]=b,s[b]=t++),void 0===u[d]&&(u[d]=v++);var g=u[d];p&&q&&(g=0),f[g]||(f[g]={values:[],key:p&&q?"values":d});var h=isNaN(b)?c?b:s[b]:parseFloat(b),i=0;void 0===h&&(h=d),void 0!==e&&(i=isNaN(e.value)?0:parseFloat(e.value)/parseFloat(e.count)),f[g].values.push({x:h,y:i})});var y,z,A={};for(y in u)z=y.substring(0,y.lastIndexOf("(")),A[z]?A[z]++:A[z]=1;if(o)for(var B=0;B<f[0].values.length;B++)y=f[0].values[B].x,y&&(z=y.substring(0,y.lastIndexOf("(")),A[z]<=1&&(f[0].values[B].x=z));else{for(var C=0;C<f.length;C++)y=f[C].key,z=y.substring(0,y.lastIndexOf("(")),A[z]<=1&&(f[C].key=z);if(1===n.length&&1===i.length)for(C=0;C<f.length;C++)y=f[C].key,y=y.split(".")[0],f[C].key=y}return{xLabels:w,d3g:f}},K=function(a){for(var c,d,e,f=b.paragraph.config.graph.scatter.xAxis,g=b.paragraph.config.graph.scatter.yAxis,h=b.paragraph.config.graph.scatter.group,i={},j=0;j<a.rows.length;j++){var k=a.rows[j];f&&(c=k[f.index]),g&&(d=k[g.index]),h&&(e=k[h.index]);var l=c+","+d+","+e;i[l]?i[l].size++:i[l]={x:c,y:d,group:e,size:1}}var m=[];for(var n in i){var o=[];f&&(o[f.index]=i[n].x),g&&(o[g.index]=i[n].y),h&&(o[h.index]=i[n].group),o[a.rows[0].length]=i[n].size,m.push(o)}return m},L=function(a,c){var d,e,f,g=b.paragraph.config.graph.scatter.xAxis,h=b.paragraph.config.graph.scatter.yAxis,i=b.paragraph.config.graph.scatter.group,j=b.paragraph.config.graph.scatter.size,k=[],l=[],m={},n=[],o={},p={},q={},r={},s={},t={},u=0,v=0,w=0,x="";if(!g&&!h)return{d3g:[]};for(var y=0;y<a.rows.length;y++)f=a.rows[y],g&&(d=f[g.index],k[y]=d),h&&(e=f[h.index],l[y]=e);var z=g&&h&&M(k)&&M(l)||!g&&M(l)||!h&&M(k);for(m=z?K(a):a.rows,!i&&z?x="count":i||j?!i&&j&&(x=j.name):g&&h?x="("+g.name+", "+h.name+")":g&&!h?x=g.name:!g&&h&&(x=h.name),y=0;y<m.length;y++){f=m[y],g&&(d=f[g.index]),h&&(e=f[h.index]),i&&(x=f[i.index]);var A=z?f[f.length-1]:j?f[j.index]:1;void 0===q[x]&&(t[w]=x,q[x]=w++),g&&void 0===o[d]&&(r[u]=d,o[d]=u++),h&&void 0===p[e]&&(s[v]=e,p[e]=v++),n[q[x]]||(n[q[x]]={key:x,values:[]}),n[q[x]].values.push({x:g?isNaN(d)?o[d]:parseFloat(d):0,y:h?isNaN(e)?p[e]:parseFloat(e):0,size:isNaN(parseFloat(A))?1:parseFloat(A)})}return{xLabels:r,yLabels:s,d3g:n}},M=function(a){for(var b=function(a){for(var b={},c=[],d=0,e=0;e<a.length;e++){var f=a[e];1!==b[f]&&(b[f]=1,c[d++]=f)}return c},c=0;c<a.length;c++)if(isNaN(parseFloat(a[c]))&&("string"==typeof a[c]||a[c]instanceof String))return!0;var d=.05,e=b(a);return e.length/a.length<d};b.isValidSizeOption=function(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e],g=f[a.size.index];if(isNaN(parseFloat(g))||!isFinite(g))return!1;if(a.xAxis){var h=f[a.xAxis.index];c[e]=h}if(a.yAxis){var i=f[a.yAxis.index];d[e]=i}}var j=a.xAxis&&a.yAxis&&M(c)&&M(d)||!a.xAxis&&M(d)||!a.yAxis&&M(c);return!j},b.resizeParagraph=function(a,c){b.paragraph.config.colWidth!==a?(b.paragraph.config.colWidth=a,b.changeColWidth(),i(function(){x(b.paragraph.id+"_editor"),b.changeHeight(c)},200)):b.changeHeight(c)},b.changeHeight=function(a){var c=angular.copy(b.paragraph.settings.params),d=angular.copy(b.paragraph.config);d.graph.height=a,z(b.paragraph.title,b.paragraph.text,d,c)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)===a}),b.goToSingleParagraph=function(){var a=d.current.pathParams.noteId,c=location.protocol+"//"+location.host+location.pathname+"#/notebook/"+a+"/paragraph/"+b.paragraph.id+"?asIframe";e.open(c)},b.showScrollDownIcon=function(){var a=angular.element("#p"+b.paragraph.id+"_text");return a[0]?a[0].scrollHeight>a.innerHeight():!1},b.scrollParagraphDown=function(){var a=angular.element("#p"+b.paragraph.id+"_text");a.animate({scrollTop:a[0].scrollHeight},500),b.keepScrollDown=!0},b.showScrollUpIcon=function(){return angular.element("#p"+b.paragraph.id+"_text")[0]?0!==angular.element("#p"+b.paragraph.id+"_text")[0].scrollTop:!1},b.scrollParagraphUp=function(){var a=angular.element("#p"+b.paragraph.id+"_text");a.animate({scrollTop:0},500),b.keepScrollDown=!1}}]),angular.module("zeppelinWebApp").controller("SearchResultCtrl",["$scope","$routeParams","searchService",function(a,b,c){var d=c.search({q:b.searchTerm}).query();d.$promise.then(function(c){a.notes=c.body.map(function(a){return/\/paragraph\//.test(a.id)?(a.id=a.id.replace("paragraph/","?paragraph=")+"&term="+b.searchTerm,a):a})}),a.page=0,a.allResults=!1,a.highlightSearchResults=function(a){return function(b){function c(a){var b={"ace/mode/scala":/^%spark/,"ace/mode/sql":/^%(\w*\.)?\wql/,"ace/mode/markdown":/^%md/,"ace/mode/sh":/^%sh/};return Object.keys(b).reduce(function(c,d){return b[d].test(a)?d:c},"ace/mode/scala")}function d(a){return function(b){for(var c=[],d=-1;(d=b.indexOf(a,d+1))>=0;)c.push(d);return c}}var e=ace.require("ace/range").Range;b.setOption("highlightActiveLine",!1),b.$blockScrolling=1/0,b.setReadOnly(!0),b.renderer.setShowGutter(!1),b.setTheme("ace/theme/chrome"),b.getSession().setMode(c(a.text));var f=a.snippet.split("\n").map(function(a,c){var f=a.match(/<B>(.+?)<\/B>/);if(!f)return a;var g=f[1],h=a.replace(/<B>/g,"").replace(/<\/B>/g,""),i=d(g)(h);return i.forEach(function(a){var d=a+g.length;b.getSession().addMarker(new e(c,a,c,d),"search-results-highlight","line")}),h});b.setOption("maxLines",f.reduce(function(a,b){return a+b.length},0)),b.getSession().setValue(f.join("\n"))}}}]),angular.module("zeppelinWebApp").service("arrayOrderingSrv",function(){this.notebookListOrdering=function(a){return a.name?a.name:"Note "+a.id}}),angular.module("zeppelinWebApp").controller("NavCtrl",["$scope","$rootScope","$routeParams","$location","notebookListDataFactory","websocketMsgSrv","arrayOrderingSrv",function(a,b,c,d,e,f,g){function h(){f.getNotebookList()}function i(a){return c.noteId===a}function j(a,b){for(var c=0;c<menuData.length;c++)for(var d=0;d<menuData[c].notebooks.length;d++)if(menuData[c].notebooks[d]==b)return menuData[c].notebooks[a]}function k(a){for(var b=0;b<menuData.length;b++)for(var c=0;c<menuData[b].notebooks.length;c++)if(menuData[b].notebooks[c]==a)return c;return 0}a.showLoginWindow=function(){setTimeout(function(){angular.element("#userName").focus()},500)};var l=this;l.notes=e,l.connected=f.isConnected(),l.websocketMsgSrv=f,l.arrayOrderingSrv=g,l.menuType=b.menuType?b.menuType:k(c.noteId),b.menuType=l.menuType,b.ticket&&(b.fullUsername=b.ticket.principal,b.truncatedUsername=b.ticket.principal);var m=16;angular.element("#notebook-list").perfectScrollbar({suppressScrollX:!0}),a.$on("setNoteMenu",function(a,d){e.setNotes(d),l.notes.list=menuData,l.menuType=b.menuType?b.menuType:k(c.noteId)}),a.$on("setConnectedStatus",function(a,b){l.connected=b}),b.$on("$locationChangeSuccess",function(){var b=d.path();"/"===b&&(a.searchTerm="")}),a.checkUsername=function(){b.ticket&&(b.ticket.principal.length<=m?b.truncatedUsername=b.ticket.principal:b.truncatedUsername=b.ticket.principal.substr(0,m)+"..")},a.$on("loginSuccess",function(b,c){a.checkUsername(),h()}),a.search=function(){d.url(/search/+a.searchTerm)},l.loadNotes=h,l.isActive=i,l.loadNotes(),a.checkUsername(),a.$on("menuChanged",function(a,e){l.menuType=e,b.menuType=e,d.url("/notebook/"+j(e,c.noteId))})}]),angular.module("zeppelinWebApp").directive("ngEscape",function(){return function(a,b,c){b.bind("keydown keyup",function(b){27===b.which&&(a.$apply(function(){a.$eval(c.ngEscape)}),b.preventDefault())})}}),angular.module("zeppelinWebApp").controller("NotenameCtrl",["$scope","notebookListDataFactory","$rootScope","$routeParams","websocketMsgSrv",function(a,b,c,d,e){var f=this;f.clone=!1,f.notes=b,f.websocketMsgSrv=e,a.note={},f.createNote=function(){if(f.clone){var b=d.noteId;f.websocketMsgSrv.cloneNotebook(b,a.note.notename)}else f.websocketMsgSrv.createNotebook(a.note.notename)},f.handleNameEnter=function(){angular.element("#noteNameModal").modal("toggle"),f.createNote()},f.preVisible=function(b){a.note.notename=f.newNoteName(),f.clone=b,a.$apply()},f.newNoteName=function(){var a=1;return angular.forEach(f.notes.list,function(b){if(b=b.name,b.match(/^Untitled Note [0-9]*$/)){var c=1*b.substr(14);c>=a&&(a=c+1)}}),"Untitled Note "+a}}]),angular.module("zeppelinWebApp").controller("NoteImportCtrl",["$scope","$timeout","websocketMsgSrv",function(a,b,c){var d=this;a.note={},a.note.step1=!0,a.note.step2=!1,d.resetFlags=function(){a.note={},a.note.step1=!0,a.note.step2=!1,angular.element("#noteImportFile").val("")},a.uploadFile=function(){angular.element("#noteImportFile").click()},a.importFile=function(b){a.note.errorText="",a.note.importFile=b.files[0];var c=a.note.importFile,e=new FileReader;e.onloadend=function(){d.processImportJson(e.result)},c&&e.readAsText(c)},a.uploadURL=function(){a.note.errorText="",a.note.step1=!1,b(function(){a.note.step2=!0},400)},d.importBack=function(){a.note.errorText="",b(function(){a.note.step1=!0},400),a.note.step2=!1},d.importNote=function(){a.note.errorText="",a.note.importUrl?jQuery.getJSON(a.note.importUrl,function(a){d.processImportJson(a)}).fail(function(){a.note.errorText="Unable to Fetch URL",a.$apply()}):(a.note.errorText="Enter URL",a.$apply())},d.processImportJson=function(b){if("object"!=typeof b)try{b=JSON.parse(b)}catch(d){return a.note.errorText="JSON parse exception",void a.$apply()}b.paragraphs&&b.paragraphs.length>0?(a.note.noteImportName?b.name=a.note.noteImportName:a.note.noteImportName=b.name,c.importNotebook(b)):a.note.errorText="Invalid JSON",a.$apply()},a.$on("setNoteMenu",function(a,b){d.resetFlags(),angular.element("#noteImportModal").modal("hide")})}]),angular.module("zeppelinWebApp").directive("popoverHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"components/popover-html-unsafe/popover-html-unsafe-popup.html"}}).directive("popoverHtmlUnsafe",["$tooltip",function(a){return a("popoverHtmlUnsafe","popover","click")}]),angular.module("zeppelinWebApp").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("zeppelinWebApp").directive("dropdownInput",function(){return{restrict:"A",link:function(a,b){b.bind("click",function(a){a.stopPropagation()})}}}),angular.module("zeppelinWebApp").directive("resizable",function(){var a={autoHide:!0,handles:"se",helper:"resizable-helper",stop:function(){angular.element(this).css({width:"100%",height:"100%"})}};return{restrict:"A",scope:{callback:"&onResize"},link:function(b,c,d){d.$observe("resize",function(d){var e=function(c,d){var e=window.innerWidth/12;c.off("resizestop");var f=angular.copy(a);"TABLE"===d.graphType||"TEXT"===d.graphType?(f.grid=[e,10],f.minHeight=100):(f.grid=[e,1e4],f.minHeight=0),f.maxWidth=window.innerWidth,c.resizable(f),c.on("resizestop",function(){if(b.callback){var a=c.height();50>a&&(a=300),b.callback({width:Math.ceil(c.width()/e),height:a})}})};d=JSON.parse(d),"true"===d.allowresize&&(e(c,d),angular.element(window).resize(function(){e(c,d)}))})}}}),angular.module("zeppelinWebApp").directive("modalvisible",function(){return{restrict:"A",scope:{preVisibleCallback:"&previsiblecallback",postVisibleCallback:"&postvisiblecallback",targetinput:"@targetinput"},link:function(a,b,c){var d=a.preVisibleCallback,e=a.postVisibleCallback;b.on("show.bs.modal",function(a){var b=angular.element(a.relatedTarget),c=b.data("clone"),e=!!c;d()(e)}),b.on("shown.bs.modal",function(b){a.targetinput&&angular.element(b.target).find("input#"+a.targetinput).select(),e()})}}}),angular.module("zeppelinWebApp").service("websocketMsgSrv",["$rootScope","websocketEvents",function(a,b){return{getHomeNotebook:function(){b.sendNewEvent({op:"GET_HOME_NOTE"})},createNotebook:function(a){b.sendNewEvent({op:"NEW_NOTE",data:{name:a}})},deleteNotebook:function(a){b.sendNewEvent({op:"DEL_NOTE",data:{id:a}})},cloneNotebook:function(a,c){b.sendNewEvent({op:"CLONE_NOTE",data:{id:a,name:c}})},getNotebookList:function(){b.sendNewEvent({op:"LIST_NOTES"})},reloadAllNotesFromRepo:function(){b.sendNewEvent({op:"RELOAD_NOTES_FROM_REPO"})},getNotebook:function(a){b.sendNewEvent({op:"GET_NOTE",data:{id:a}})},updateNotebook:function(a,c,d){b.sendNewEvent({op:"NOTE_UPDATE",data:{id:a,name:c,config:d}})},moveParagraph:function(a,c){b.sendNewEvent({op:"MOVE_PARAGRAPH",data:{id:a,index:c}})},insertParagraph:function(a){b.sendNewEvent({op:"INSERT_PARAGRAPH",data:{index:a}})},updateAngularObject:function(a,c,d,e,f){b.sendNewEvent({op:"ANGULAR_OBJECT_UPDATED",data:{noteId:a,paragraphId:c,name:d,value:e,interpreterGroupId:f}})},clientBindAngularObject:function(a,c,d,e){b.sendNewEvent({op:"ANGULAR_OBJECT_CLIENT_BIND",data:{noteId:a,name:c,value:d,paragraphId:e}})},clientUnbindAngularObject:function(a,c,d){b.sendNewEvent({op:"ANGULAR_OBJECT_CLIENT_UNBIND",data:{noteId:a,name:c,paragraphId:d}})},cancelParagraphRun:function(a){b.sendNewEvent({op:"CANCEL_PARAGRAPH",data:{id:a}})},runParagraph:function(a,c,d,e,f){b.sendNewEvent({op:"RUN_PARAGRAPH",data:{id:a,title:c,paragraph:d,config:e,params:f}})},removeParagraph:function(a){b.sendNewEvent({op:"PARAGRAPH_REMOVE",data:{id:a}})},clearParagraphOutput:function(a){b.sendNewEvent({op:"PARAGRAPH_CLEAR_OUTPUT",data:{id:a}})},completion:function(a,c,d){b.sendNewEvent({op:"COMPLETION",data:{id:a,buf:c,cursor:d}})},commitParagraph:function(a,c,d,e,f){b.sendNewEvent({op:"COMMIT_PARAGRAPH",data:{id:a,title:c,paragraph:d,config:e,params:f}})},importNotebook:function(a){b.sendNewEvent({op:"IMPORT_NOTE",data:{notebook:a}})},checkpointNotebook:function(a,c){b.sendNewEvent({op:"CHECKPOINT_NOTEBOOK",data:{noteId:a,commitMessage:c}})},isConnected:function(){return b.isConnected()}}}]),angular.module("zeppelinWebApp").factory("websocketEvents",["$rootScope","$websocket","$location","baseUrlSrv",function(a,b,c,d){var e={};return e.ws=b(d.getWebsocketUrl()),e.ws.reconnectIfNotNormalClose=!0,e.ws.onOpen(function(){a.$broadcast("setConnectedStatus",!0),setInterval(function(){e.sendNewEvent({op:"PING"})},1e4)}),e.sendNewEvent=function(b){void 0!==a.ticket?(b.principal=a.ticket.principal,b.ticket=a.ticket.ticket,b.roles=a.ticket.roles):(b.principal="",b.ticket="",b.roles=""),e.ws.send(JSON.stringify(b))},e.isConnected=function(){return 1===e.ws.socket.readyState},e.ws.onMessage(function(b){var d;b.data&&(d=angular.fromJson(b.data));var e=d.op,f=d.data;"NOTE"===e?a.$broadcast("setNoteContent",f.note):"NEW_NOTE"===e?c.path("notebook/"+f.note.id):"NOTES_INFO"===e?a.$broadcast("setNoteMenu",f.notes):"AUTH_INFO"===e?BootstrapDialog.alert({closable:!0,title:"Insufficient privileges",message:f.info.toString()}):"PARAGRAPH"===e?a.$broadcast("updateParagraph",f):"PARAGRAPH_APPEND_OUTPUT"===e?a.$broadcast("appendParagraphOutput",f):"PARAGRAPH_UPDATE_OUTPUT"===e?a.$broadcast("updateParagraphOutput",f):"PROGRESS"===e?a.$broadcast("updateProgress",f):"COMPLETION_LIST"===e?a.$broadcast("completionList",f):"ANGULAR_OBJECT_UPDATE"===e?a.$broadcast("angularObjectUpdate",f):"ANGULAR_OBJECT_REMOVE"===e&&a.$broadcast("angularObjectRemove",f);
}),e.ws.onError(function(b){a.$broadcast("setConnectedStatus",!1)}),e.ws.onClose(function(b){a.$broadcast("setConnectedStatus",!1)}),e}]),angular.module("zeppelinWebApp").factory("notebookListDataFactory",function(){var a={};return a.list=[],a.setNotes=function(b){a.list=angular.copy(b)},a}),angular.module("zeppelinWebApp").service("baseUrlSrv",function(){this.getPort=function(){var a=Number(location.port);return a||(a=80,"https:"===location.protocol&&(a=443)),3333!==a&&9e3!==a||(a=8080),a},this.getWebsocketUrl=function(){var b="https:"===location.protocol?"wss:":"ws:";return b+"//"+location.hostname+":"+this.getPort()+a(location.pathname)+"/ws"},this.getRestApiBase=function(){return location.protocol+"//"+location.hostname+":"+this.getPort()+a(location.pathname)+"/api"};var a=function(a){return a.replace(/\/$/,"")}}),angular.module("zeppelinWebApp").service("browserDetectService",function(){this.detectIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}}),angular.module("zeppelinWebApp").service("SaveAsService",["browserDetectService",function(a){this.SaveAs=function(b,c,d){if(a.detectIE()){angular.element("body").append('<iframe id="SaveAsId" style="display: none"></iframe>');var e=angular.element("body > iframe#SaveAsId")[0].contentWindow;e.document.open("text/json","replace"),e.document.write(b),e.document.close(),e.focus();var f=Date.now();e.document.execCommand("SaveAs",!1,c+"."+d);var g=Date.now();f===g&&e.document.execCommand("SaveAs",!0,c+".txt"),angular.element("body > iframe#SaveAsId").remove()}else{b="data:image/svg;charset=utf-8,"+encodeURIComponent(b),angular.element("body").append('<a id="SaveAsId"></a>');var h=angular.element("body > a#SaveAsId");h.attr("href",b),h.attr("download",c+"."+d),h.attr("target","_blank"),h[0].click(),h.remove()}}}]),angular.module("zeppelinWebApp").service("searchService",["$resource","baseUrlSrv",function(a,b){this.search=function(c){if(c.q){var d=window.encodeURIComponent(c.q);return a(b.getRestApiBase()+"/notebook/search?q="+d,{},{query:{method:"GET"}})}}}]),angular.module("zeppelinWebApp").controller("LoginCtrl",["$scope","$rootScope","$http","$httpParamSerializer","baseUrlSrv",function(a,b,c,d,e){a.loginParams={},a.login=function(){c({method:"POST",url:e.getRestApiBase()+"/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:d({userName:a.loginParams.userName,password:a.loginParams.password})}).then(function(a){b.ticket=a.data.body,angular.element("#loginModal").modal("toggle"),b.$broadcast("loginSuccess",!0)},function(b){a.loginParams.errorText="The username and password that you entered don't match."})}}]),angular.module("zeppelinWebApp").controller("sidebarCtrl",["$scope","$rootScope","$routeParams","$location","notebookListDataFactory","websocketMsgSrv","arrayOrderingSrv",function(a,b,c,d,e,f,g){function h(a){b.$broadcast("menuChanged",a)}var i=this;i.switchMenuType=h}]);var menuData=[{name:"All Apps",notebooks:["2BFX9NR3Y","2BFF7MCKJ","2BGYFQD1D"]},{name:"AMPS",notebooks:["2BK1ARANT","2BHKK7N9P","2BGYFQD1D"]},{name:"tapps",notebooks:["2BHBBZ9AX","2BGAZ47EB","2BGYFQD1D"]}],colSettings={"2BFX9NR3Y":[{field:"summary",width:"*",wordWrap:!0,cellTooltip:!0,enableHiding:!1,cellTemplate:'<div ng-bind-html="row.entity[col.field]"></div>'}],"2BK1ARANT":[{field:"summary",width:"*",wordWrap:!0,cellTooltip:!0,enableHiding:!1,cellTemplate:'<div ng-bind-html="row.entity[col.field]"></div>'}],"2BHBBZ9AX":[{field:"summary",width:"*",wordWrap:!0,cellTooltip:!0,enableHiding:!1,cellTemplate:'<div ng-bind-html="row.entity[col.field]"></div>'}],"3BFX9NR3Y":[{name:"Date",field:"Date",displayName:"Date",width:"13%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"ReqId",field:"ReqId",displayName:"Request Id",width:"18%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"HttpMethod",field:"HttpMethod",displayName:"Method",width:"7%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"Request",field:"Request",displayName:"Request",width:"15%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"ResponseTime",field:"ResponseTime",displayName:"Time (ms)",width:"5%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"StatusCode",field:"StatusCode",displayName:"Res Code",width:"7%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"Response",field:"Response",displayName:"Response",width:"35%",wordWrap:!0,cellTooltip:!0,enableHiding:!1}],"3BK1ARANT":[{name:"Date",field:"Date",displayName:"Date",width:"13%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"ReqId",field:"ReqId",displayName:"Request Id",width:"18%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"HttpMethod",field:"HttpMethod",displayName:"Method",width:"7%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"Request",field:"Request",displayName:"Request",width:"15%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"ResponseTime",field:"ResponseTime",displayName:"Time (ms)",width:"5%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"StatusCode",field:"StatusCode",displayName:"Res Code",width:"7%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"Response",field:"Response",displayName:"Response",width:"35%",wordWrap:!0,cellTooltip:!0,enableHiding:!1}],"3BHBBZ9AX":[{name:"Date",field:"Date",displayName:"Date",width:"13%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"ReqId",field:"ReqId",displayName:"Request Id",width:"18%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"HttpMethod",field:"HttpMethod",displayName:"Method",width:"7%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"Request",field:"Request",displayName:"Request",width:"15%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"ResponseTime",field:"ResponseTime",displayName:"Time (ms)",width:"5%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"StatusCode",field:"StatusCode",displayName:"Res Code",width:"7%",wordWrap:!0,cellTooltip:!0,enableHiding:!1},{name:"Response",field:"Response",displayName:"Response",width:"35%",wordWrap:!0,cellTooltip:!0,enableHiding:!1}]},refreshInterval=1e4;